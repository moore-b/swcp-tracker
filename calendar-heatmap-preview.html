<!-- calendar-heatmap-preview.html -->
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <title>Calendar Heatmap Preview</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="tailwind.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <style>
      /* Tailwind-equivalent solid colors so the file works standalone */
      .heat-cell { width: 18px; height: 18px; }
      .heat-0 { background:#e5e7eb; }  /* gray-200 */
      .heat-1 { background:#bbf7d0; }  /* emerald-200 */
      .heat-2 { background:#4ade80; }  /* emerald-400 */
      .heat-3 { background:#16a34a; }  /* emerald-600 */
      .heat-4 { background:#166534; }  /* emerald-800 */

      /* Dark-mode overrides */
      @media (prefers-color-scheme: dark) {
        .heat-0 { background:#374151; }  /* gray-700 */
        .heat-1 { background:#166534; }  /* emerald-800 */
        .heat-2 { background:#16a34a; }  /* emerald-600 */
        .heat-3 { background:#4ade80; }  /* emerald-400 */
        .heat-4 { background:#bbf7d0; }  /* emerald-200 */
      }

      /* utility: hide scrollbar while preserving scrollability */
      .no-scrollbar {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none;    /* Firefox */
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;            /* Chrome, Safari, Opera */
      }
    </style>
  </head>

  <body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center p-6">
    <!-- Dashboard-style blurred tile wrapper -->
    <div class="p-6 rounded-2xl shadow-xl blurred-tile-background border border-white/20 w-full max-w-full">
      <h1 class="text-xl font-semibold mb-4 text-center" style="color:#f5f1e8;">Activity Heatmap</h1>

      <!-- Row containing day labels + heatmap grid -->
      <div class="flex">
        <!-- Day labels column -->
        <div id="day-labels" class="flex flex-col space-y-1 mr-2 flex-none"></div>

        <!-- Month row + grid wrapper to keep them aligned -->
        <div id="heatmap-wrapper" class="flex-1 overflow-x-auto min-w-0 no-scrollbar">
          <div id="month-labels" class="flex space-x-1 text-xs mb-1 pl-[2px] w-max"></div>
          <div id="heatmap" class="flex space-x-1 w-max"></div>
        </div>
      </div>

      <!-- explanatory caption removed as requested -->
    </div>

    <!-- Simple modal for multi-activity days -->
    <div id="activity-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 rounded-lg p-4 w-80 shadow-lg">
        <h3 id="modal-date" class="font-semibold text-lg mb-3 text-gray-800 dark:text-gray-200 text-center"></h3>
        <ul id="modal-list" class="space-y-2 max-h-60 overflow-y-auto"></ul>
        <button id="modal-close" class="mt-4 w-full bg-emerald-600 hover:bg-emerald-700 text-white rounded py-2">Close</button>
      </div>
    </div>

    <script>
      // ---------- generate sample data ----------
      const today = new Date();
      const data = {};

      // Simulate 3 years of sample data (approx 156 weeks)
      const sampleDays = 365 * 3;
      for (let i = 0; i <= sampleDays; i++) {
        const d = new Date();
        d.setDate(today.getDate() - i);
        const key = d.toISOString().slice(0, 10);
        // 70% chance of an activity day, may include up to 3 activities
        if (Math.random() < 0.7) {
          const acts = [];
          const actCount = Math.ceil(Math.random() * 3);
          let totalKm = 0;
          for (let a = 0; a < actCount; a++) {
            const km = parseFloat((Math.random() * 20 + 2).toFixed(1));
            totalKm += km;
            acts.push({ id: Math.floor(Math.random() * 1e9), distance: km });
          }
          data[key] = { totalKm, acts };
        } else {
          data[key] = { totalKm: 0, acts: [] };
        }
      }

      // Earliest date present in data
      const earliestKey = Object.keys(data).sort()[0];
      const earliestDate = new Date(earliestKey);

      // ---------- map value -> heat class ----------
      const scale = (km) => {
        if (km === 0) return "heat-0";     // rest day
        if (km < 5)   return "heat-1";     // short
        if (km < 15)  return "heat-2";     // medium
        if (km < 30)  return "heat-3";     // long
        return "heat-4";                   // ultra
      };

      // ---------- create day labels (Mon, Wed, Fri) ----------
      const dayLabelsContainer = document.getElementById("day-labels");
      const dayNames = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

      // top spacer to align with month labels row
      const spacer = document.createElement("span");
      spacer.style.height = "18px";
      spacer.style.lineHeight = "18px";
      dayLabelsContainer.appendChild(spacer);

      // create day labels starting with Monday
      for (let row = 0; row < 7; row++) {
        const span = document.createElement("span");
        span.style.height = "18px";
        span.style.lineHeight = "18px";
        span.style.fontSize = "12px";
        span.className = "text-gray-600 dark:text-gray-300";
        span.textContent = dayNames[row];
        dayLabelsContainer.appendChild(span);
      }

      // ---------- build 53 weekly columns & month labels ----------
      const heatmapContainer = document.getElementById("heatmap");
      const monthLabelsContainer = document.getElementById("month-labels");

      // Determine Monday for current week and earliest week
      const currentMonday = new Date(today);
      currentMonday.setDate(today.getDate() - ((today.getDay() + 6) % 7));

      const earliestMonday = new Date(earliestDate);
      earliestMonday.setDate(earliestDate.getDate() - ((earliestDate.getDay() + 6) % 7));

      const millisPerWeek = 7 * 24 * 60 * 60 * 1000;
      const totalWeeks = Math.floor((currentMonday - earliestMonday) / millisPerWeek) + 1; // inclusive

      let prevMonth = -1;
      for (let col = totalWeeks - 1; col >= 0; col--) {
        // --- calculate Monday of this column's week ---
        const weekStart = new Date(currentMonday);
        weekStart.setDate(currentMonday.getDate() - col * 7);

        // --- month label (based on weekStart) ---
        const month = weekStart.getMonth();
        const monthSpan = document.createElement("span");
        monthSpan.style.width = "18px";
        monthSpan.className = "text-center text-gray-600 dark:text-gray-300";
        monthSpan.style.fontSize = "12px";
        if (month !== prevMonth) {
          monthSpan.textContent = weekStart.toLocaleString("default", { month: "short" });
          prevMonth = month;
        }
        monthLabelsContainer.appendChild(monthSpan);

        // --- week column ---
        const week = document.createElement("div");
        week.className = "flex flex-col space-y-1";
        for (let row = 0; row < 7; row++) {
          const cellDate = new Date(weekStart);
          cellDate.setDate(weekStart.getDate() + row);
          const key = cellDate.toISOString().slice(0, 10);
          const { totalKm, acts } = data[key] || { totalKm: 0, acts: [] };

          const cell = document.createElement("div");
          cell.className = "rounded heat-cell";
          cell.classList.add(scale(totalKm));
          cell.title = `${key}: ${totalKm} km`;
          week.appendChild(cell);

          if (acts.length) {
            cell.classList.add("cursor-pointer");
            cell.addEventListener("click", () => {
              if (acts.length === 1) {
                window.open(`https://www.strava.com/activities/${acts[0].id}`, "_blank");
              } else {
                showModal(key, acts);
              }
            });
          }
        }
        heatmapContainer.appendChild(week);
      }

      // ---------- wheel -> horizontal scroll helper ----------
      const wrapper = document.getElementById("heatmap-wrapper");
      wrapper.addEventListener(
        "wheel",
        (e) => {
          if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
            e.preventDefault();
            wrapper.scrollLeft += e.deltaY;
          }
        },
        { passive: false }
      );

      // ---------- modal helpers ----------
      const modal = document.getElementById("activity-modal");
      const modalDate = document.getElementById("modal-date");
      const modalList = document.getElementById("modal-list");
      const closeBtn = document.getElementById("modal-close");

      const showModal = (dateStr, activities) => {
        modalDate.textContent = dateStr;
        modalList.innerHTML = "";
        activities.forEach((act) => {
          const li = document.createElement("li");
          const link = document.createElement("a");
          link.href = `https://www.strava.com/activities/${act.id}`;
          link.target = "_blank";
          link.className = "text-emerald-600 hover:underline";
          link.textContent = `${act.distance} km (ID ${act.id})`;
          li.appendChild(link);
          modalList.appendChild(li);
        });
        modal.classList.remove("hidden");
      };

      closeBtn.addEventListener("click", () => modal.classList.add("hidden"));
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.classList.add("hidden");
      });
    </script>
  </body>
</html> 